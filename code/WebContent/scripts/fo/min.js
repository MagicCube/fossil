/* Wed Sep 11 12:34:38 CST 2013 */
/* Generated by MagicCube MXBuild with MXFramework */
$ns("fo.ani");$import("fo.ani.Splash");$import("fo.ani.To2D");
fo.ani.Animation=function(){var a=$extend(MXComponent),d={};a.nextAnimation=null;a.view=null;a.camera=null;a.objects=null;a.duration=0;a.onstart=null;a.oncomplete=null;d.init=a.init;a.init=function(b){d.init(b);a.on("complete",a._oncomplete)};a.start=function(){TWEEN.removeAll();a.trigger("start")};a.chain=function(b){a.nextAnimation=b;return a.nextAnimation};a._oncomplete=function(){null!=a.nextAnimation&&a.nextAnimation.start();a.nextAnimation=null;a.view=null;a.camera=null;a.objects=null};return a.endOfClass(arguments)};
fo.ani.Animation.createInstance=function(a,d){return new fo.ani[a](d)};$ns("fo.ani");
fo.ani.Splash=function(){var a=$extend(fo.ani.Animation),d={};a.duration=8E3;a.range=6200;d.init=a.init;a.init=function(a){d.init(a)};d.start=a.start;a.start=function(){d.start();(new TWEEN.Tween(a.camera.position)).to({z:3800},0.5*a.duration).easing(TWEEN.Easing.Cubic.Out).start();(new TWEEN.Tween(a.rootObject.rotation)).to({y:2*Math.PI,x:2*Math.PI,z:2*Math.PI},24E4).easing(TWEEN.Easing.Sinusoidal.InOut).repeat(1E3).start();a.explode()};a.explode=function(){for(var b=0.7*a.duration,d=0;d<a.objects.length;d++)(new TWEEN.Tween(a.objects[d].position)).delay(Math.random()*
b/2+0.2*a.duration).to({x:Math.random()*a.range-a.range/2,y:Math.random()*a.range-a.range/2,z:Math.random()*a.range-a.range/2},b/2).easing(TWEEN.Easing.Exponential.InOut).start();setTimeout(function(){a.trigger("complete")},b)};return a.endOfClass(arguments)};$ns("fo.ani");
fo.ani.To2D=function(){function a(){d.view.switchTo2D();for(var a=0;a<d.objects.length;a++){var b=d.objects[a];b.element.style.top=b.element.style.top.replace("-","")}}var d=$extend(fo.ani.Animation),b={};d.duration=8E3;b.init=d.init;d.init=function(a){b.init(a)};b.start=d.start;d.start=function(){b.start();TWEEN.removeAll();for(var e=d.duration,k=d.view.$container.children(".taxon"),f=0;f<fo.taxons.length;f++){var c=fo.taxons[f],c={left:c.start+d.view.padding.left,width:c.end-c.start,height:18,top:19*
-f-d.view.padding.top,borderOpacity:0};if(f<d.objects.length){var g=d.objects[f];(new TWEEN.Tween(g.rotation)).delay(Math.random()*e/2).to({x:0,y:0,z:0},e/2).easing(TWEEN.Easing.Exponential.Out).start();(new TWEEN.Tween(g.position)).delay(Math.random()*e/3).to({x:0,y:0,z:0},2*(e/3)).easing(TWEEN.Easing.Exponential.Out).start();(new TWEEN.Tween({taxonDiv:g.element,taxonInnerDiv:g.element.childNodes[0],width:280,height:280,top:0,borderOpacity:0.2})).delay(Math.random()*e/3).to(c,2*(e/3)).easing(TWEEN.Easing.Exponential.Out).onUpdate(function(){this.taxonInnerDiv.style.borderRadius=
0;this.taxonDiv.style.top=this.top+"px";this.taxonInnerDiv.style.borderColor="rgba(255, 255, 255, "+this.borderOpacity+")";this.taxonInnerDiv.style.width=this.width+"px";this.taxonInnerDiv.style.height=this.height+"px";this.taxonInnerDiv.style.left=this.left+"px"}).onComplete(function(){this.taxonInnerDiv.style.border="none"}).start()}else g=k[f-d.objects.length].childNodes[0],g.style.width=c.width+"px",g.style.height=c.height+"px",g.style.left=c.left+"px"}(new TWEEN.Tween(d.rootObject.rotation)).to({x:0,
y:0,z:0},e).easing(TWEEN.Easing.Exponential.InOut).start();(new TWEEN.Tween(d.camera.rotation)).delay(Math.random()*e/2).to({x:0,y:0,z:0},e/2).easing(TWEEN.Easing.Exponential.InOut).start();k=704/(d.view.frame.width/d.view.frame.height/(16/9))*(d.view.frame.width/1920);(new TWEEN.Tween(d.camera.position)).to({x:d.view.frame.width/2,y:-d.view.frame.height/2,z:k},e).easing(TWEEN.Easing.Exponential.InOut).onComplete(function(){setTimeout(a,200)}).start()};return d.endOfClass(arguments)};$ns("fo");$import("lib.three.Three",function(){$import("lib.three.control.TrackballControls");$import("lib.three.renderer.CSS3DRenderer")});$import("lib.d3.D3");$import("lib.jquery.plugin.Transit");$import("lib.tween.Tween");$import("fo.view.SearchBoxView");$import("fo.scn.TaxonDetailScene");$import("fo.scn.DiversityScene");$import("fo.scn.OverviewScene");$import("fo.scn.WelcomeScene");$include("fo.res.App.css");
fo.App=function(){var a=$extend(mx.app.Application);a.appId="fo.App";a.appDisplayName="The Fossil Project";var d={};a.scenes=[];a.rootScene=null;a.activeScene=null;a.poppedScene=null;a.homeSceneName="Welcome";a.taxons=[];a.sections=[];var b=a.searchBoxView=null,e=null;d.init=a.init;a.init=function(b){a.frame={width:window.innerWidth,height:window.innerHeight};d.init(b);a.initBackground();a.initOverlay();a.loadTaxons();a.loadSections();a.initSearchBoxView();a.$container.on("mousewheel",function(a){a.preventDefault()})};
a.initBackground=function(){b=$("\x3cimg id\x3d'background' src\x3d'"+mx.getResourcePath("fo.res.images.background","jpg")+"'\x3e");a.$container.append(b)};a.initOverlay=function(){e=$("\x3cdiv id\x3d'overlay'/\x3e");e.on("click",function(b){b.target==e.get(0)&&a.hidePoppedScene()})};a.initSearchBoxView=function(){a.searchBoxView=new fo.view.SearchBoxView({frame:{left:0,top:0}});a.searchBoxView.hide();a.addSubview(a.searchBoxView)};a.loadTaxons=function(){$.ajax({url:$mappath("~/data/taxons.json"),
async:!1}).success(function(a){fo.taxons=[];for(var b=0;b<a.length;b++){var c=a[b];fo.taxons.add(c);fo.taxons[c.id]=c}fo.taxons=fo.taxons.sort(function(a,c){return a.start-c.start})})};a.loadSections=function(){$.ajax({url:$mappath("~/data/sections.json"),async:!1}).success(function(a){fo.sections=[];for(var b=0;b<a.length;b++){var c=a[b];fo.sections[c.id]=c;fo.sections.add(c)}})};d.run=a.run;a.run=function(b){a.setRootScene(a.homeSceneName)};$(document).on("keydown",function(b){if(null!=a.activeScene&&
isFunction(a.activeScene.onKeydown))a.activeScene.onKeydown(b)});a.getScene=function(b,d){var c=a.scenes[b];if(null==c){var c=fo.scn[b+"Scene"],e=null;d&&(e={left:0,top:0,width:a.frame.width,height:a.frame.height});c=new c({id:b,frame:e});a.scenes[b]=c;a.scenes.add(c)}return c};a.setRootScene=function(b,d){var c=a.getScene(b,!0);null!=a.activeScene&&(a.activeScene.deactivate(),a.activeScene.$container.detach(),a.activeScene=null);c.$container.addClass("root");a.$container.append(c.$container);a.rootScene=
c;a.activeScene=c;c.activate(d,!1)};a.popupScene=function(b,d){var c=a.getScene(b);null!=a.activeScene&&(a.activeScene.deactivate(),a.activeScene=null);a.searchBoxView.$container.fadeOut();c.$container.addClass("popped");e.hide();a.$container.append(e);e.fadeIn();a.$container.append(c.$container);a.poppedScene=c;a.activeScene=c;c.activate(d,!1);c.$container.css({scale:1,opacity:0,left:(a.frame.width-c.frame.width)/2,top:(a.frame.height-c.frame.height)/2});c.$container.transit({opacity:1,width:c.frame.width,
height:c.frame.height},400,"ease");return c};a.hidePoppedScene=function(){if(null!=a.poppedScene){var b=a.poppedScene;e.fadeOut(function(){e.detach()});a.poppedScene.deactivate();a.poppedScene.$container.transit({opacity:0,scale:0.2},300,"ease",function(){b.$container.detach()});a.poppedScene.$container.removeClass("popped");a.poppedScene=null;a.activeScene=null;null!=a.rootScene&&(a.activateScene=a.rootScene,a.activateScene.activate({},!0));a.searchBoxView.$container.fadeIn()}};return a.endOfClass(arguments)};$ns("fo.scn");$import("fo.view.GlobeView3D");$include("fo.res.DiversityScene.css");
fo.scn.DiversityScene=function(){var a=$extend(mx.scn.Scene);a.title="";a.autoFillParent=!0;var d={};a.globeView=null;d.init=a.init;a.init=function(b){d.init(b);a.initGlobeView()};a.initGlobeView=function(){a.globeView=new fo.view.GlobeView3D({frame:{left:0,top:0,width:a.frame.width,height:a.frame.height}});a.addSubview(a.globeView);d3.tsv($mappath("~/data/section.txt"),function(b){for(var d=[],k=0;k<b.length;k++){var f=b[k];d.add({value:parseInt(f.id),location:{lng:parseFloat(f.lng),lat:parseFloat(f.lat)}})}console.log(d);
a.globeView.addData(d)})};d.activate=a.activate;a.activate=function(b,e){d.activate(b,e);e||($("#projectLogo").fadeIn(),a.globeView.startAnimation())};return a.endOfClass(arguments)};$ns("fo.scn");$import("fo.view.TaxonSeqView3D");$include("fo.res.OverviewScene.css");
fo.scn.OverviewScene=function(){var a=$extend(mx.scn.Scene);a.autoFillParent=!0;a.elementClass="OverviewScene";var d={};a.seqView=null;d.init=a.init;a.init=function(b){d.init(b);a.initSeqView()};a.initSeqView=function(){a.seqView=new fo.view.TaxonSeqView3D({frame:{left:0,top:0,width:a.frame.width,height:a.frame.height-0}});a.addSubview(a.seqView)};d.activate=a.activate;a.activate=function(a,b){d.activate(a,b);b||$("#projectLogo").fadeIn()};var b=!1;a.onKeydown=function(d){if(!b&&(13==d.keyCode||32==
d.keyCode))b=!0,a.seqView.startAnimation("To2D")};return a.endOfClass(arguments)};$ns("fo.scn");$import("fo.view.TaxonInfoView");$import("fo.view.HeatmapView");$import("fo.view.PlayControlView");$include("fo.res.TaxonDetailScene.css");
fo.scn.TaxonDetailScene=function(){var a=$extend(mx.scn.Scene);a.elementClass="TaxonDetailScene";a.autoFillParent=!0;var d={};a.taxon=null;a.mapView=null;a.playControlView=null;var b=a.infoView=null,e=null;d.init=a.init;a.init=function(b){var e=1280,c=720;e>fo.app.frame.width&&(e=fo.app.frame.width);c>fo.app.frame.height&&(c=fo.app.frame.height);a.frame={width:e,height:c};d.init(b);a.initTitle();a.initDimension();a.initInfoView();a.initPlayControlView();a.initMapView()};a.initTitle=function(){b=$("\x3ch1 id\x3d'title'\x3e");
a.$container.append(b)};a.initDimension=function(){e=$("\x3ch1 id\x3d'dimension'\x3e");a.$container.append(e)};a.initInfoView=function(){a.infoView=fo.view.TaxonInfoView({frame:{top:15,left:15}});a.addSubview(a.infoView)};a.initMapView=function(){var b=$("\x3cdiv id\x3d'map'/\x3e");$(document.body).append(b);a.mapView=new fo.view.HeatmapView({id:"map",$element:b,playControlView:a.playControlView,frame:{left:0,right:0,top:0,bottom:0}});a.addSubview(a.mapView)};a.initPlayControlView=function(){a.playControlView=
new fo.view.PlayControlView({frame:{bottom:10,left:10,right:10}});a.addSubview(a.playControlView)};d.activate=a.activate;a.activate=function(b,e){d.activate(b,e);e||a.setTaxon(b.taxon)};d.deactivate=a.deactivate;a.deactivate=function(){d.deactivate();a.playControlView.pause()};a.setTaxon=function(d){a.taxon=d;b.text(a.taxon.title);a.infoView.setTaxon(a.taxon);a.playControlView.setRange([a.taxon.start,a.taxon.end])};a.onKeydown=function(b){if(27==b.keyCode)fo.app.hidePoppedScene();else if(13==b.keyCode||
32==b.keyCode)a.playControlView.togglePlay();else if(39==b.keyCode||40==b.keyCode)a.playControlView.pause(),a.playControlView.moveToNextFrame(),b.stopPropagation(),b.preventDefault();else if(37==b.keyCode||38==b.keyCode)a.playControlView.pause(),a.playControlView.moveToPreviousFrame(),b.stopPropagation(),b.preventDefault()};return a.endOfClass(arguments)};$ns("fo.scn");$include("fo.res.WelcomeScene.css");
fo.scn.WelcomeScene=function(){function a(){e=$("#intro");e.css({left:(d.frame.width-800)/2,top:0.35*(d.frame.height-e.height())});e.on("click",function(){d.start()});d.$container.append(e)}var d=$extend(mx.scn.Scene);d.autoFillParent=!0;d.elementClass="WelcomeScene";var b={},e=null;b.init=d.init;d.init=function(d){b.init(d);a()};b.activate=d.activate;d.activate=function(a,d){b.activate(a,d);d||(e.css({display:"block",opacity:0,webkitTransform:"scale(0.96)"}),e.transit({opacity:1,scale:1},2E3))};
d.start=function(){e.fadeOut(function(){e.remove();fo.app.setRootScene("Overview")})};d.onKeydown=function(a){(13==a.keyCode||32==a.keyCode)&&d.start()};return d.endOfClass(arguments)};$ns("fo.view");$import("fo.view.View3D");$include("fo.res.GlobeView3D.css");
fo.view.GlobeView3D=function(){var a=$extend(fo.view.View3D);a.elementClass="GlobeView3D";a.isAnimating=!0;a.antialias=!1;var d={};a.sphereGeometry=null;a.earth=null;var b=a.points=null,e=null;d.init=a.init;a.init=function(a){d.init(a);b=new THREE.Geometry;a=new THREE.CubeGeometry(0.75,0.75,1,1,1,1,null,!1);for(var f=0;f<a.vertices.length;f++)a.vertices[f].z+=0.5;e=new THREE.Mesh(a)};a.initCamera=function(){a.camera=new THREE.PerspectiveCamera(45,a.frame.width/a.frame.height,0.1,1E4);a.camera.position.x=
-55;a.camera.position.y=177;a.camera.position.z=-623};d.initObjects=a.initObjects;a.initObjects=function(){a.geometry=new THREE.IcosahedronGeometry(200,4);a.initEarth()};a.initEarth=function(){var b=new THREE.ShaderMaterial({uniforms:{texture:{type:"t",value:THREE.ImageUtils.loadTexture(mx.getResourcePath("fo.res.images.world","jpg"))}},vertexShader:"varying vec3 vNormal;\nvarying vec2 vUv;\nvoid main() {\ngl_Position \x3d projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvNormal \x3d normalize( normalMatrix * normal );\nvUv \x3d uv;\n}",
fragmentShader:"uniform sampler2D texture;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvoid main() {\nvec3 diffuse \x3d texture2D( texture, vUv ).xyz;\nfloat intensity \x3d 1.05 - dot( vNormal, vec3( 0.0, 0.0, 1.0 ) );\nvec3 atmosphere \x3d vec3( 1.0, 1.0, 1.0 ) * pow( intensity, 3.0 );\ngl_FragColor \x3d vec4( diffuse + atmosphere, 1.0 );\n}"});a.earth=new THREE.Mesh(a.geometry,b);a.scene.add(a.earth)};d.startAnimation=a.startAnimation;a.startAnimation=function(){d.startAnimation();null==a.trackballControl&&
a.initTrackballControl()};a.addPoint=function(d,f,c){var g=(90-d.lat)*Math.PI/180;d=(180-d.lng)*Math.PI/180;e.position.x=200*Math.sin(g)*Math.cos(d);e.position.y=200*Math.cos(g);e.position.z=200*Math.sin(g)*Math.sin(d);e.lookAt(a.earth.position);e.scale.z=-f;e.updateMatrix();for(f=0;f<e.geometry.faces.length;f++)e.geometry.faces[f].color=c;THREE.GeometryUtils.merge(b,e)};a.addData=function(d){for(var e=d3.max(d,function(a){return a.value}),c=0;c<d.length;c++){var g=d[c];a.addPoint(g.location,80*(g.value/
e),a.colorScale(g.value/e))}a.points=new THREE.Mesh(b,new THREE.MeshBasicMaterial({color:16777215,vertexColors:THREE.FaceColors,morphTargets:!1}));a.scene.add(a.points)};a.colorScale=function(a){var b=new THREE.Color;b.setHSV(0.6-0.5*a,1,1);return b};return a.endOfClass(arguments)};$ns("fo.view");$import("fo.view.MapView");$include("fo.res.HeatmapView.css");
fo.view.HeatmapView=function(){function a(a){}var d=$extend(fo.view.MapView);d.elementClass="HeatmapView";var b={};d.playControlView=null;d.heatmapLayer=null;d.dataSet=null;b.init=d.init;d.init=function(a){b.init(a);null!=d.playControlView&&d.setPlayControlView(d.playControlView)};b.initLayers=d.initLayers;d.initLayers=function(){b.initLayers();d.initHeatmap()};d.initHeatmap=function(){d.heatmapLayer=L.TileLayer.heatmap({radius:{value:4,absolute:!1},opacity:0.8,gradient:{"0.2":"rgb(0,0,255)","0.4":"rgb(0,255,255)",
"0.6":"rgb(0,255,0)","0.75":"yellow","0.85":"rgb(255,0,0)"}});d.map.addLayer(d.heatmapLayer);d.dataSet=[];for(var a=0;a<fo.sections.length;a++){var b=fo.sections[a],f={location:b.location,value:0};d.dataSet[b.id]=f;d.dataSet.add(f)}};d.setPlayControlView=function(b){null!=d.playControlView&&(d.playControlView.off("positionchanged",a),d.playControlView=null);null!=b&&(d.playControlView=b,d.playControlView.on("positionchanged",a))};return d.endOfClass(arguments)};$ns("fo.view");$import("lib.quadtree.QuadTree");$import("lib.heatmap.Heatmap");$import("lib.leaflet.Leaflet",function(){$import("lib.leaflet.plugin.Heatmap");$import("lib.leaflet.plugin.Mapbox")});$include("lib.leaflet.leaflet.css");$include("lib.leaflet.plugin.mapbox.css");$include("fo.res.MapView.css");
fo.view.MapView=function(){var a=$extend(mx.view.View),d={};a.map=null;a.$map=null;a.mapElement=null;a.baseTileUrl="https://tiles.mapbox.com/v3/henryli.map-ccti13xw/{z}/{x}/{y}.png";a.defaultZoom=4;a.defaultLocation={lat:25,lng:132};a.layers=[];a.layerSwitcher=null;d.init=a.init;a.init=function(b){d.init(b);a.$element.addClass("MapView");a.$map=new $("\x3cdiv class\x3dLmap\x3e");a.mapElement=a.$map.get(0);a.$element.append(a.$map);a.initMap()};a.initMap=function(){a.map=L.mapbox.map(a.mapElement,
"henryli.map-ccti13xw",{minZoom:3,maxZoom:10,zoomControl:!1,attributionControl:!1});window.Lmap=a.map;a.initLayers();a.zoomToDefault()};a.initLayers=function(){};a.addLayer=function(b,d,k,f,c){a.layers.add(b);a.layers[d]=b;!1!=f&&a.map.addLayer(b)};a.removeLayer=function(b){isString(b)&&(b=a.layers[b]);a.map.removeLayer(b);a.layers.remove(b)};a.zoomTo=function(b,d){a.map.setView(b,d)};a.zoomToDefault=function(){a.zoomTo(a.defaultLocation,a.defaultZoom)};return a.endOfClass(arguments)};$ns("fo.view");$include("fo.res.PlayControlView.css");
fo.view.PlayControlView=function(){function a(){"playing"==c.playState&&(requestAnimationFrame(a),c.onFraming())}function d(a){c.togglePlay()}function b(a){$(document.body).css({webkitUserSelect:"none"});$(document.body).on("mousemove",e);$(document.body).on("mouseup",k)}function e(a){a=f(a);c.setPositionPercentage(a)}function k(a){a=f(a);c.setPositionPercentage(a);$(document.body).css({webkitUserSelect:""});$(document.body).off("mousemove",e);$(document.body).off("mouseup",k)}function f(a){var b=
m.position().left+c.$container.position().left+c.$container.parent().position().left;return(a.pageX-b-15)/(m.width()-15)}var c=$extend(mx.view.View);c.elementClass="PlayControlView";var g={};c.playState=null;c.position=0;c.positionPercentage=0;c.range=[0,100];c.onplaystatechanged=null;var h=c.onpositionchanged=null,l=null,m=null,q=null,n=null,p=null;g.init=c.init;c.init=function(a){g.init(a);h=$("\x3cdiv id\x3d'label'/\x3e");c.$container.append(h);l=$("\x3cdiv id\x3dplayPause/\x3e");l.on("click",
d);c.$container.append(l);m=$("\x3cdiv id\x3dprogressBar\x3e\x3cdiv id\x3dcursor\x3e\x3c/div\x3e\x3c/div\x3e");m.on("mousedown",b);q=m.children("#cursor");c.$container.append(m);n=$("\x3cdiv id\x3d'start' class\x3d'range'/\x3e");p=$("\x3cdiv id\x3d'end' class\x3d'range'/\x3e");c.$container.append(n);c.$container.append(p);c.setRange(c.range);c.pause()};c.play=function(){var b=c.setPlayState("playing");b&&(c.position>=c.range[1]&&c.setPosition(c.range[0]),a());return b};c.pause=function(){return c.setPlayState("paused")};
c.togglePlay=function(){"playing"==c.playState?c.pause():"paused"==c.playState&&c.play()};c.setPlayState=function(a){if(c.playState==a)return!1;c.playState=a;"playing"==c.playState?c.$container.addClass("playing").removeClass("paused"):"paused"==c.playState&&c.$container.addClass("paused").removeClass("playing");c.trigger("playstatechanged");return!0};c.setRange=function(a){c.pause();c.range=a;n.text(c.range[0]);p.text(c.range[1]);c.setPosition(c.range[0],!0)};c.setPosition=function(a,b){a>c.range[1]?
a=c.range[1]:a<c.range[0]&&(a=c.range[0]);if(c.position!=a||b)c.position=a,c.positionPercentage=(c.position-c.range[0])/(c.range[1]-c.range[0]),c.update(),h.text("#"+c.position),c.trigger("positionchanged");return c.position};c.setPositionPercentage=function(a){c.setPosition(Math.round(a*(c.range[1]-c.range[0])+c.range[0]))};c.update=function(){h.text(c.position);q.css({width:(m.width()-15)*c.positionPercentage+15})};c.moveToNextFrame=function(){c.setPosition(c.position+1,!0)};c.moveToPreviousFrame=
function(){c.setPosition(c.position-1,!0)};c.onFraming=function(){c.position>=c.range[1]?c.pause():c.moveToNextFrame()};return c.endOfClass(arguments)};$ns("fo.view");$include("fo.res.SearchBoxView.css");
fo.view.SearchBoxView=function(){function a(){null!=h&&(clearTimeout(h),h=null);h=setTimeout(d,800)}function d(a){f.text!=g.val()&&(f.text=g.val(),f.trigger("changed"),null!=f.delegate&&isFunction(f.delegate.search)&&f.delegate.search(f.text,f))}function b(c){48<=c.keyCode&&90>=c.keyCode&&(g.val(""),g.focus(),$(document.body).off("keydown",b),a())}function e(b){a();27==b.keyCode&&(""!=g.val()?g.val(""):g.blur())}function k(a){$(document.body).on("keydown",b)}var f=$extend(mx.view.View);f.elementClass=
"SearchBoxView";f.frame={width:550};var c={};f.text="";f.delegate=null;var g=f.onchanged=null;c.init=f.init;f.init=function(a){c.init(a);f.$container.append("\x3cdiv id\x3d'head'/\x3e\x3cdiv id\x3d'body'/\x3e\x3cdiv id\x3d'tail'/\x3e\x3cinput/\x3e");g=f.$container.children("input");g.on("keydown",e);g.on("blur",k);$(document.body).on("keydown",b)};var h=null;return f.endOfClass(arguments)};$ns("fo.view");$include("fo.res.TaxonInfoView.css");
fo.view.TaxonInfoView=function(){var a=$extend(mx.view.View);a.elementClass="TaxonInfoView";var d={},b=a.taxon=null,e=null;d.init=a.init;a.init=function(k){d.init(k);b=$("\x3ch1 id\x3d'name'\x3eSchizolus dubiiformis\x3c/h1\x3e");a.$container.append(b);e=$("\x3cdiv id\x3d'detailList'/\x3e");e.append("\x3cdl\x3e\x3cdt\x3eRank:\x3c/dt\x3e \x3cdd id\x3d'rank'\x3e#1\x3c/dd\x3e\x3c/dl\x3e");e.append("\x3cdl\x3e\x3cdt\x3eClass:\x3c/dt\x3e \x3cdd id\x3d'cls'\x3eBivalvia\x3c/dd\x3e\x3c/dl\x3e");e.append("\x3cdl\x3e\x3cdt\x3eGenus:\x3c/dt\x3e \x3cdd id\x3d'genus'\x3ePalaeoneilo\x3c/dd\x3e\x3c/dl\x3e");
e.append("\x3cdl\x3e\x3cdt\x3eAuthor:\x3c/dt\x3e \x3cdd id\x3d'author'\x3eLi Xin\x3c/dd\x3e\x3c/dl\x3e");a.$container.append(e)};a.setTaxon=function(b){a.taxon=b;b={name:b.fullName,rank:"#"+(fo.taxons.indexOf(b)+1),cls:b.cls,genus:b.genus,author:b.author+"("+b.year+")"};for(var d in b){var c=b[d];a.$container.find("#"+d).text(c?c:"N/A")}};return a.endOfClass(arguments)};$ns("fo.view");$import("fo.view.View3D");$import("fo.ani.Animation");$include("fo.res.TaxonSeqView.css");$include("fo.res.TaxonSeqView3D.css");
fo.view.TaxonSeqView3D=function(){function a(a){a=fo.taxons[this.id];fo.app.popupScene("TaxonDetail",{taxon:a,title:a.fullName})}function d(a){if(a.shiftKey){a.preventDefault();var d=b.scale+a.originalEvent.wheelDelta/1E3;1<d?d=1:0.1>d&&(d=0.1);b.setScale(d)}else 0<a.originalEvent.wheelDeltaX&&0==b.$scene.get(0).scrollLeft&&a.preventDefault();a.stopPropagation()}var b=$extend(fo.view.View3D);b.elementClass="TaxonSeqView";b.renderingMode="css";var e={};b.mode="2D";b.scale=1;b.padding={top:75,left:25,
right:25};b.rootObject=null;b.$scene=null;b.$camera=null;b.styleSheet=null;e.init=b.init;b.init=function(a){e.init(a);b.startAnimation("Splash");for(a=a=0;a<document.styleSheets.length&&!document.styleSheets[a].href.contains("TaxonSeqView.css");a++);b.styleSheet=document.styleSheets[a]};e.initScene=b.initScene;b.initScene=function(){b.switchTo3D();"fast"==$speed&&setTimeout(function(){b.startAnimation("To2D")},50);e.initScene()};e.initCamera=b.initCamera;b.initCamera=function(){e.initCamera();b.camera.position.z=
0};b.initTaxons=function(){var a=d3.select(b.$container.get(0)).selectAll(".taxon").data(fo.taxons).enter().append("div").classed("taxon",!0).attr({id:function(a){return a.id}}).append("div").style({"background-color":function(){return"rgba(123, 29, 32, "+(0.4+0.5*Math.random())+")"}});a.append("span").attr("id","name").text(function(a){return a.name});a.append("span").attr("id","fullName").text(function(a){return a.fullName})};b.initObjects=function(){b.initTaxons();b.rootObject=new THREE.Object3D;
for(var a=new THREE.Vector3,d=b.$container.find(".taxon"),c=0;500>c;c++){var e=d.get(c),e=new THREE.CSS3DObject(e),h=Math.acos(-1+2*c/500),l=Math.sqrt(500*Math.PI)*h;e.position.x=1750*Math.cos(l)*Math.sin(h);e.position.y=1750*Math.sin(l)*Math.sin(h);e.position.z=1750*Math.cos(h);a.copy(e.position).multiplyScalar(2);e.lookAt(a);b.objects.add(e);b.rootObject.add(e)}b.scene.add(b.rootObject)};e.startAnimation=b.startAnimation;b.startAnimation=function(a,d){var c=null,c=fo.ani.Animation.createInstance(a,
{camera:b.camera,scene:b.scene,rootObject:b.rootObject,objects:b.objects,view:b});null!=c&&("fast"==$speed?c.duration*=0.05:"slow"==$speed&&(c.duration*=1.5),c.start());e.startAnimation();return c};b.switchTo3D=function(){b.mode="3D";b.$container.removeClass("two-d");b.$container.addClass("three-d")};b.switchTo2D=function(){b.stopAnimation();b.isRendering=!1;b.mode="2D";fo.app.searchBoxView.$container.delay(600).fadeIn("slow");b.$container.append("\x3cdiv id\x3d'topShadow' class\x3d'shadow'/\x3e\x3cdiv id\x3d'bottomShadow' class\x3d'shadow'/\x3e");
b.$container.find(".shadow").hide().fadeIn(5E3);b.$container.find(".camera").css({transform:"",webkitTransformStyle:"",webkitPerspective:""});b.$container.find(".scene").css({transform:"",webkitTransformStyle:"",webkitPerspective:""});b.$container.find(".taxon").css({transform:"",webkitTransformStyle:"",top:"",position:""});b.$container.find(".taxon div").css({height:"",border:"",borderRadius:""});b.$scene=b.$container.find(".scene");b.$scene.css({width:"",height:""});b.$camera=b.$container.find(".camera");
b.$camera.css({"-webkit-transform-origin-x":"","-webkit-transform-origin-y":"",width:"",height:""});b.$container.addClass("two-d");b.$container.removeClass("three-d");b.$camera.append(b.$container.children(".taxon"));b.$camera.append("\x3cdiv id\x3dplaceHolder/\x3e");TWEEN.removeAll();fo.app.searchBoxView.delegate=b;b.$scene.css("overflow","auto").on("mousewheel",d);b.$scene.on("click",".taxon",a)};b.search=function(a,d){b.setScale(1);var c=a.trim().toLowerCase();b.$scene.scrollTop(0);for(var e=0;e<
fo.taxons.length;e++){var h=fo.taxons[e],l=b.$container.find(".taxon#"+h.id);h.fullName.toLowerCase().startsWith(c)?l.show():l.hide()}};b.setScale=function(a){b.scale!=a&&(b.scale=a,a=parseInt(18*b.scale),b.styleSheet.rules[3].style.height=a+"px",b.styleSheet.rules[5].style.display=0.8<=b.scale?"":"none")};return b.endOfClass(arguments)};$ns("fo.view");
fo.view.View3D=function(){var a=$extend(mx.view.View);a.elementClass="View3D";var d={};a.isRendering=!0;a.isAnimating=!1;a.antialias=!1;a.scene=null;a.camera=null;a.renderer=null;a.renderingMode="webgl";a.rendererClass=THREE.WebGLRenderer;a.trackballControl=null;a.objects=[];a.onrendering=null;d.init=a.init;a.init=function(b){d.init(b);a.initScene();a.initCamera();a.initRenderer()};a.initScene=function(){a.scene=new THREE.Scene;a.initObjects()};a.initObjects=function(){};a.initRenderer=function(){a.rendererClass=
"css"==a.renderingMode?THREE.CSS3DRenderer:"canvas"==a.renderingMode?THREE.CanvasRenderer:THREE.WebGLRenderer;a.renderer=new a.rendererClass({antialias:a.antialias});a.renderer.setSize(a.frame.width,a.frame.height);a.$element.get(0).appendChild(a.renderer.domElement)};a.initCamera=function(){a.camera=new THREE.PerspectiveCamera(75,a.frame.width/a.frame.height,150,1E3)};a.initTrackballControl=function(){null==a.trackballControl&&(a.trackballControl=new THREE.TrackballControls(a.camera,a.renderer.domElement),
a.trackballControl.rotateSpeed=0.5,a.on("rendering",function(){a.trackballControl.update()}))};a.render=function(){a.isAnimating&&requestAnimationFrame(a.render);a.isRendering&&a.trigger("rendering");TWEEN.update();a.isRendering&&a.renderer.render(a.scene,a.camera)};a.startAnimation=function(){a.isAnimating=!0;a.render()};a.stopAnimation=function(){a.isAnimating=!1};return a.endOfClass(arguments)};