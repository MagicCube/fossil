/* Wed Sep 11 00:13:42 CST 2013 */
/* Generated by MagicCube MXBuild with MXFramework */
$ns("fo.ani");$import("fo.ani.Splash");$import("fo.ani.To2D");
fo.ani.Animation=function(){var a=$extend(MXComponent),c={};a.nextAnimation=null;a.view=null;a.camera=null;a.objects=null;a.duration=0;a.onstart=null;a.oncomplete=null;c.init=a.init;a.init=function(b){c.init(b);a.on("complete",a._oncomplete)};a.start=function(){TWEEN.removeAll();a.trigger("start")};a.chain=function(b){a.nextAnimation=b;return a.nextAnimation};a._oncomplete=function(){null!=a.nextAnimation&&a.nextAnimation.start();a.nextAnimation=null;a.view=null;a.camera=null;a.objects=null};return a.endOfClass(arguments)};
fo.ani.Animation.createInstance=function(a,c){return new fo.ani[a](c)};$ns("fo.ani");
fo.ani.Splash=function(){var a=$extend(fo.ani.Animation),c={};a.duration=8E3;a.range=6200;c.init=a.init;a.init=function(a){c.init(a)};c.start=a.start;a.start=function(){c.start();(new TWEEN.Tween(a.camera.position)).to({z:3800},0.5*a.duration).easing(TWEEN.Easing.Cubic.Out).start();(new TWEEN.Tween(a.rootObject.rotation)).to({y:2*Math.PI,x:2*Math.PI,z:2*Math.PI},24E4).easing(TWEEN.Easing.Sinusoidal.InOut).repeat(1E3).start();a.explode()};a.explode=function(){for(var b=0.7*a.duration,c=0;c<a.objects.length;c++)(new TWEEN.Tween(a.objects[c].position)).delay(Math.random()*
b/2+0.2*a.duration).to({x:Math.random()*a.range-a.range/2,y:Math.random()*a.range-a.range/2,z:Math.random()*a.range-a.range/2},b/2).easing(TWEEN.Easing.Exponential.InOut).start();setTimeout(function(){a.trigger("complete")},b)};return a.endOfClass(arguments)};$ns("fo.ani");
fo.ani.To2D=function(){function a(){c.view.switchTo2D();for(var a=0;a<c.objects.length;a++){var b=c.objects[a];b.element.style.top=b.element.style.top.replace("-","")}}var c=$extend(fo.ani.Animation),b={};c.duration=8E3;b.init=c.init;c.init=function(a){b.init(a)};b.start=c.start;c.start=function(){b.start();TWEEN.removeAll();for(var e=c.duration,k=c.view.$container.children(".taxon"),f=0;f<fo.taxons.length;f++){var d=fo.taxons[f],d={left:d.start+c.view.padding.left,width:d.end-d.start,height:18,top:19*
-f-c.view.padding.top,borderOpacity:0};if(f<c.objects.length){var g=c.objects[f];(new TWEEN.Tween(g.rotation)).delay(Math.random()*e/2).to({x:0,y:0,z:0},e/2).easing(TWEEN.Easing.Exponential.Out).start();(new TWEEN.Tween(g.position)).delay(Math.random()*e/3).to({x:0,y:0,z:0},2*(e/3)).easing(TWEEN.Easing.Exponential.Out).start();(new TWEEN.Tween({taxonDiv:g.element,taxonInnerDiv:g.element.childNodes[0],width:280,height:280,top:0,borderOpacity:0.2})).delay(Math.random()*e/3).to(d,2*(e/3)).easing(TWEEN.Easing.Exponential.Out).onUpdate(function(){this.taxonInnerDiv.style.borderRadius=
0;this.taxonDiv.style.top=this.top+"px";this.taxonInnerDiv.style.borderColor="rgba(255, 255, 255, "+this.borderOpacity+")";this.taxonInnerDiv.style.width=this.width+"px";this.taxonInnerDiv.style.height=this.height+"px";this.taxonInnerDiv.style.left=this.left+"px"}).onComplete(function(){this.taxonInnerDiv.style.border="none"}).start()}else g=k[f-c.objects.length].childNodes[0],g.style.width=d.width+"px",g.style.height=d.height+"px",g.style.left=d.left+"px"}(new TWEEN.Tween(c.rootObject.rotation)).to({x:0,
y:0,z:0},e).easing(TWEEN.Easing.Exponential.InOut).start();(new TWEEN.Tween(c.camera.rotation)).delay(Math.random()*e/2).to({x:0,y:0,z:0},e/2).easing(TWEEN.Easing.Exponential.InOut).start();k=704/(c.view.frame.width/c.view.frame.height/(16/9))*(c.view.frame.width/1920);(new TWEEN.Tween(c.camera.position)).to({x:c.view.frame.width/2,y:-c.view.frame.height/2,z:k},e).easing(TWEEN.Easing.Exponential.InOut).onComplete(function(){setTimeout(a,200)}).start()};return c.endOfClass(arguments)};$ns("fo");$import("lib.three.Three",function(){$import("lib.three.control.TrackballControls");$import("lib.three.renderer.CSS3DRenderer")});$import("lib.d3.D3");$import("lib.jquery.plugin.Transit");$import("lib.tween.Tween");$import("fo.view.SearchBoxView");$import("fo.scn.TaxonDetailScene");$import("fo.scn.DiversityScene");$import("fo.scn.OverviewScene");$import("fo.scn.WelcomeScene");$include("fo.res.App.css");
fo.App=function(){var a=$extend(mx.app.Application);a.appId="fo.App";a.appDisplayName="The Fossil Project";var c={};a.scenes=[];a.rootScene=null;a.activeScene=null;a.poppedScene=null;a.homeSceneName="Welcome";a.taxons=[];a.sections=[];var b=a.searchBoxView=null,e=null;c.init=a.init;a.init=function(b){a.frame={width:window.innerWidth,height:window.innerHeight};c.init(b);a.initBackground();a.initOverlay();a.loadTaxons();a.loadSections();a.initSearchBoxView();a.$container.on("mousewheel",function(a){a.preventDefault()})};
a.initBackground=function(){b=$("\x3cimg id\x3d'background' src\x3d'"+mx.getResourcePath("fo.res.images.background","jpg")+"'\x3e");a.$container.append(b)};a.initOverlay=function(){e=$("\x3cdiv id\x3d'overlay'/\x3e");e.on("click",function(b){b.target==e.get(0)&&a.hidePoppedScene()})};a.initSearchBoxView=function(){a.searchBoxView=new fo.view.SearchBoxView({frame:{left:0,top:0}});a.searchBoxView.hide();a.addSubview(a.searchBoxView)};a.loadTaxons=function(){$.ajax({url:$mappath("~/data/taxons.json"),
async:!1}).success(function(a){fo.taxons=[];for(var b=0;b<a.length;b++){var d=a[b];fo.taxons.add(d);fo.taxons[d.id]=d}fo.taxons=fo.taxons.sort(function(a,b){return a.start-b.start})})};a.loadSections=function(){$.ajax({url:$mappath("~/data/sections.json"),async:!1}).success(function(a){fo.sections=[];for(var b=0;b<a.length;b++){var d=a[b];fo.sections[d.id]=d;fo.sections.add(d)}})};c.run=a.run;a.run=function(b){a.setRootScene(a.homeSceneName)};$(document).on("keydown",function(b){if(null!=a.activeScene&&
isFunction(a.activeScene.onKeydown))a.activeScene.onKeydown(b)});a.getScene=function(b,c){var d=a.scenes[b];if(null==d){var d=fo.scn[b+"Scene"],e=null;c&&(e={left:0,top:0,width:a.frame.width,height:a.frame.height});d=new d({id:b,frame:e});a.scenes[b]=d;a.scenes.add(d)}return d};a.setRootScene=function(b,c){var d=a.getScene(b,!0);null!=a.activeScene&&(a.activeScene.deactivate(),a.activeScene.$container.detach(),a.activeScene=null);d.$container.addClass("root");a.$container.append(d.$container);a.rootScene=
d;a.activeScene=d;d.activate(c,!1)};a.popupScene=function(b,c){var d=a.getScene(b);null!=a.activeScene&&(a.activeScene.deactivate(),a.activeScene=null);a.searchBoxView.$container.fadeOut();d.$container.addClass("popped");e.hide();a.$container.append(e);$("#projectLogo").transit({opacity:0});e.fadeIn();a.$container.append(d.$container);a.poppedScene=d;a.activeScene=d;d.activate(c,!1);d.$container.css({scale:4,opacity:0});d.$container.transit({opacity:1,scale:1,left:(window.innerWidth-d.frame.width)/
2,top:(window.innerHeight-d.frame.height)/2,width:d.frame.width,height:d.frame.height},400,"ease");return d};a.hidePoppedScene=function(){if(null!=a.poppedScene){var b=a.poppedScene;e.fadeOut(function(){e.detach()});a.poppedScene.deactivate();a.poppedScene.$container.transit({opacity:0,scale:0.2},300,"ease",function(){b.$container.detach()});a.poppedScene.$container.removeClass("popped");a.poppedScene=null;a.activeScene=null;null!=a.rootScene&&(a.activateScene=a.rootScene,a.activateScene.activate({},
!0));a.searchBoxView.$container.fadeIn();$("#projectLogo").transit({opacity:1},2E3)}};return a.endOfClass(arguments)};$ns("fo.scn");$import("fo.view.GlobeView3D");$include("fo.res.DiversityScene.css");
fo.scn.DiversityScene=function(){var a=$extend(mx.scn.Scene);a.title="";a.autoFillParent=!0;var c={};a.globeView=null;c.init=a.init;a.init=function(b){c.init(b);a.initGlobeView()};a.initGlobeView=function(){a.globeView=new fo.view.GlobeView3D({frame:{left:0,top:0,width:a.frame.width,height:a.frame.height}});a.addSubview(a.globeView);d3.tsv($mappath("~/data/section.txt"),function(b){for(var c=[],k=0;k<b.length;k++){var f=b[k];c.add({value:parseInt(f.id),location:{lng:parseFloat(f.lng),lat:parseFloat(f.lat)}})}console.log(c);
a.globeView.addData(c)})};c.activate=a.activate;a.activate=function(b,e){c.activate(b,e);e||($("#projectLogo").fadeIn(),a.globeView.startAnimation())};return a.endOfClass(arguments)};$ns("fo.scn");$import("fo.view.TaxonSeqView");$include("fo.res.OverviewScene.css");
fo.scn.OverviewScene=function(){var a=$extend(mx.scn.Scene);a.autoFillParent=!0;a.elementClass="OverviewScene";var c={};a.seqView=null;c.init=a.init;a.init=function(b){c.init(b);a.initSeqView()};a.initSeqView=function(){a.seqView=new fo.view.TaxonSeqView({frame:{left:0,top:0,width:a.frame.width,height:a.frame.height-0}});a.addSubview(a.seqView)};c.activate=a.activate;a.activate=function(a,b){c.activate(a,b);b||$("#projectLogo").fadeIn()};var b=!1;a.onKeydown=function(c){if(!b&&(13==c.keyCode||32==
c.keyCode))b=!0,a.seqView.startAnimation("To2D")};return a.endOfClass(arguments)};$ns("fo.scn");$import("fo.view.TaxonInfoView");$import("fo.view.HeatmapView");$import("fo.view.PlayControlView");$include("fo.res.TaxonDetailScene.css");
fo.scn.TaxonDetailScene=function(){var a=$extend(mx.scn.Scene);a.elementClass="TaxonDetailScene";a.autoFillParent=!0;var c={};a.taxon=null;a.mapView=null;a.playControlView=null;var b=a.infoView=null,e=null;c.init=a.init;a.init=function(b){a.frame={width:fo.app.frame.width,height:fo.app.frame.height};c.init(b);a.initTitle();a.initDimension();a.initInfoView();a.initPlayControlView();a.initMapView()};a.initTitle=function(){b=$("\x3ch1 id\x3d'title'\x3e");a.$container.append(b)};a.initDimension=function(){e=
$("\x3ch1 id\x3d'dimension'\x3e");a.$container.append(e)};a.initInfoView=function(){a.infoView=fo.view.TaxonInfoView({frame:{top:15,left:15}});a.addSubview(a.infoView)};a.initMapView=function(){var b=$("\x3cdiv id\x3d'map'/\x3e");$(document.body).append(b);a.mapView=new fo.view.HeatmapView({id:"map",$element:b,playControlView:a.playControlView,frame:{left:0,right:0,top:0,bottom:0}});a.addSubview(a.mapView)};a.initPlayControlView=function(){a.playControlView=new fo.view.PlayControlView({frame:{bottom:10,
left:10,right:10}});a.addSubview(a.playControlView)};c.activate=a.activate;a.activate=function(b,e){c.activate(b,e);e||a.setTaxon(b.taxon)};c.deactivate=a.deactivate;a.deactivate=function(){c.deactivate();a.playControlView.pause()};a.setTaxon=function(c){a.taxon=c;b.text(a.taxon.title);a.infoView.setTaxon(a.taxon);a.playControlView.setRange([a.taxon.start,a.taxon.end])};a.onKeydown=function(b){if(27==b.keyCode)fo.app.hidePoppedScene();else if(13==b.keyCode||32==b.keyCode)a.playControlView.togglePlay();
else if(39==b.keyCode||40==b.keyCode)a.playControlView.pause(),a.playControlView.moveToNextFrame(),b.stopPropagation(),b.preventDefault();else if(37==b.keyCode||38==b.keyCode)a.playControlView.pause(),a.playControlView.moveToPreviousFrame(),b.stopPropagation(),b.preventDefault()};return a.endOfClass(arguments)};$ns("fo.scn");$include("fo.res.WelcomeScene.css");
fo.scn.WelcomeScene=function(){function a(){e=$("#intro");e.css({left:(c.frame.width-800)/2,top:0.35*(c.frame.height-e.height())});e.on("click",function(){c.start()});c.$container.append(e)}var c=$extend(mx.scn.Scene);c.autoFillParent=!0;c.elementClass="WelcomeScene";var b={},e=null;b.init=c.init;c.init=function(c){b.init(c);a()};b.activate=c.activate;c.activate=function(a,c){b.activate(a,c);c||(e.css({display:"block",opacity:0,webkitTransform:"scale(0.96)"}),e.transit({opacity:1,scale:1},2E3))};
c.start=function(){e.fadeOut(function(){e.remove();fo.app.setRootScene("Overview")})};c.onKeydown=function(a){(13==a.keyCode||32==a.keyCode)&&c.start()};return c.endOfClass(arguments)};$ns("fo.view");$import("fo.view.View3D");$include("fo.res.GlobeView3D.css");
fo.view.GlobeView3D=function(){var a=$extend(fo.view.View3D);a.elementClass="GlobeView3D";a.isAnimating=!0;a.antialias=!1;var c={};a.sphereGeometry=null;a.earth=null;var b=a.points=null,e=null;c.init=a.init;a.init=function(a){c.init(a);b=new THREE.Geometry;a=new THREE.CubeGeometry(0.75,0.75,1,1,1,1,null,!1);for(var f=0;f<a.vertices.length;f++)a.vertices[f].z+=0.5;e=new THREE.Mesh(a)};a.initCamera=function(){a.camera=new THREE.PerspectiveCamera(45,a.frame.width/a.frame.height,0.1,1E4);a.camera.position.x=
-55;a.camera.position.y=177;a.camera.position.z=-623};c.initObjects=a.initObjects;a.initObjects=function(){a.geometry=new THREE.IcosahedronGeometry(200,4);a.initEarth()};a.initEarth=function(){var b=new THREE.ShaderMaterial({uniforms:{texture:{type:"t",value:THREE.ImageUtils.loadTexture(mx.getResourcePath("fo.res.images.world","jpg"))}},vertexShader:"varying vec3 vNormal;\nvarying vec2 vUv;\nvoid main() {\ngl_Position \x3d projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvNormal \x3d normalize( normalMatrix * normal );\nvUv \x3d uv;\n}",
fragmentShader:"uniform sampler2D texture;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvoid main() {\nvec3 diffuse \x3d texture2D( texture, vUv ).xyz;\nfloat intensity \x3d 1.05 - dot( vNormal, vec3( 0.0, 0.0, 1.0 ) );\nvec3 atmosphere \x3d vec3( 1.0, 1.0, 1.0 ) * pow( intensity, 3.0 );\ngl_FragColor \x3d vec4( diffuse + atmosphere, 1.0 );\n}"});a.earth=new THREE.Mesh(a.geometry,b);a.scene.add(a.earth)};c.startAnimation=a.startAnimation;a.startAnimation=function(){c.startAnimation();null==a.trackballControl&&
a.initTrackballControl()};a.addPoint=function(c,f,d){var g=(90-c.lat)*Math.PI/180;c=(180-c.lng)*Math.PI/180;e.position.x=200*Math.sin(g)*Math.cos(c);e.position.y=200*Math.cos(g);e.position.z=200*Math.sin(g)*Math.sin(c);e.lookAt(a.earth.position);e.scale.z=-f;e.updateMatrix();for(f=0;f<e.geometry.faces.length;f++)e.geometry.faces[f].color=d;THREE.GeometryUtils.merge(b,e)};a.addData=function(c){for(var e=d3.max(c,function(a){return a.value}),d=0;d<c.length;d++){var g=c[d];a.addPoint(g.location,80*(g.value/
e),a.colorScale(g.value/e))}a.points=new THREE.Mesh(b,new THREE.MeshBasicMaterial({color:16777215,vertexColors:THREE.FaceColors,morphTargets:!1}));a.scene.add(a.points)};a.colorScale=function(a){var b=new THREE.Color;b.setHSV(0.6-0.5*a,1,1);return b};return a.endOfClass(arguments)};$ns("fo.view");$import("fo.view.MapView");$include("fo.res.HeatmapView.css");
fo.view.HeatmapView=function(){function a(a){for(a=0;a<c.dataSet.length;a++)c.dataSet[a].value=Math.round(Math.random());c.heatmapLayer.setData(c.dataSet,1)}var c=$extend(fo.view.MapView);c.elementClass="HeatmapView";var b={};c.playControlView=null;c.heatmapLayer=null;c.dataSet=null;b.init=c.init;c.init=function(a){b.init(a);null!=c.playControlView&&c.setPlayControlView(c.playControlView)};b.initLayers=c.initLayers;c.initLayers=function(){b.initLayers();c.initHeatmap()};c.initHeatmap=function(){c.heatmapLayer=
L.TileLayer.heatmap({radius:{value:4,absolute:!1},opacity:0.8,gradient:{"0.2":"rgb(0,0,255)","0.4":"rgb(0,255,255)","0.6":"rgb(0,255,0)","0.75":"yellow","0.85":"rgb(255,0,0)"}});c.map.addLayer(c.heatmapLayer);c.dataSet=[];for(var a=0;a<fo.sections.length;a++){var b=fo.sections[a],f={location:b.location,value:0};c.dataSet[b.id]=f;c.dataSet.add(f)}};c.setPlayControlView=function(b){null!=c.playControlView&&(c.playControlView.off("positionchanged",a),c.playControlView=null);null!=b&&(c.playControlView=
b,c.playControlView.on("positionchanged",a))};return c.endOfClass(arguments)};$ns("fo.view");$import("lib.quadtree.QuadTree");$import("lib.heatmap.Heatmap");$import("lib.leaflet.Leaflet",function(){$import("lib.leaflet.plugin.Heatmap");$import("lib.leaflet.plugin.Mapbox")});$include("lib.leaflet.leaflet.css");$include("lib.leaflet.plugin.mapbox.css");$include("fo.res.MapView.css");
fo.view.MapView=function(){var a=$extend(mx.view.View),c={};a.map=null;a.$map=null;a.mapElement=null;a.baseTileUrl="https://tiles.mapbox.com/v3/henryli.map-ccti13xw/{z}/{x}/{y}.png";a.defaultZoom=4;a.defaultLocation={lat:37.579412513438385,lng:106.5234375};a.layers=[];a.layerSwitcher=null;c.init=a.init;a.init=function(b){c.init(b);a.$element.addClass("MapView");a.$map=new $("\x3cdiv class\x3dLmap\x3e");a.mapElement=a.$map.get(0);a.$element.append(a.$map);a.initMap()};a.initMap=function(){a.map=L.mapbox.map(a.mapElement,
"henryli.map-ccti13xw",{minZoom:3,maxZoom:10,zoomControl:!1,attributionControl:!1});window.Lmap=a.map;a.initLayers();a.zoomToDefault()};a.initLayers=function(){};a.addLayer=function(b,c,k,f,d){a.layers.add(b);a.layers[c]=b;!1!=f&&a.map.addLayer(b)};a.removeLayer=function(b){isString(b)&&(b=a.layers[b]);a.map.removeLayer(b);a.layers.remove(b)};a.zoomTo=function(b,c){a.map.setView(b,c)};a.zoomToDefault=function(){a.zoomTo(a.defaultLocation,a.defaultZoom)};return a.endOfClass(arguments)};$ns("fo.view");$include("fo.res.PlayControlView.css");
fo.view.PlayControlView=function(){function a(){"playing"==d.playState&&(requestAnimationFrame(a),d.onFraming())}function c(a){d.togglePlay()}function b(a){$(document.body).css({webkitUserSelect:"none"});$(document.body).on("mousemove",e);$(document.body).on("mouseup",k)}function e(a){a=f(a);d.setPositionPercentage(a)}function k(a){a=f(a);d.setPositionPercentage(a);$(document.body).css({webkitUserSelect:""});$(document.body).off("mousemove",e);$(document.body).off("mouseup",k)}function f(a){return(a.pageX-
m.offset().left+d.$container.offset().left-22)/(m.width()-15)}var d=$extend(mx.view.View);d.elementClass="PlayControlView";var g={};d.playState=null;d.position=0;d.positionPercentage=0;d.range=[0,100];d.onplaystatechanged=null;var h=d.onpositionchanged=null,l=null,m=null,q=null,n=null,p=null;g.init=d.init;d.init=function(a){g.init(a);h=$("\x3cdiv id\x3d'label'/\x3e");d.$container.append(h);l=$("\x3cdiv id\x3dplayPause/\x3e");l.on("click",c);d.$container.append(l);m=$("\x3cdiv id\x3dprogressBar\x3e\x3cdiv id\x3dcursor\x3e\x3c/div\x3e\x3c/div\x3e");
m.on("mousedown",b);q=m.children("#cursor");d.$container.append(m);n=$("\x3cdiv id\x3d'start' class\x3d'range'/\x3e");p=$("\x3cdiv id\x3d'end' class\x3d'range'/\x3e");d.$container.append(n);d.$container.append(p);d.setRange(d.range);d.pause()};d.play=function(){var b=d.setPlayState("playing");b&&(d.position>=d.range[1]&&d.setPosition(d.range[0]),a());return b};d.pause=function(){return d.setPlayState("paused")};d.togglePlay=function(){"playing"==d.playState?d.pause():"paused"==d.playState&&d.play()};
d.setPlayState=function(a){if(d.playState==a)return!1;d.playState=a;"playing"==d.playState?d.$container.addClass("playing").removeClass("paused"):"paused"==d.playState&&d.$container.addClass("paused").removeClass("playing");d.trigger("playstatechanged");return!0};d.setRange=function(a){d.pause();d.range=a;n.text(d.range[0]);p.text(d.range[1]);d.setPosition(d.range[0],!0)};d.setPosition=function(a,b){a>d.range[1]?a=d.range[1]:a<d.range[0]&&(a=d.range[0]);if(d.position!=a||b)d.position=a,d.positionPercentage=
(d.position-d.range[0])/(d.range[1]-d.range[0]),d.update(),h.text("#"+d.position),d.trigger("positionchanged");return d.position};d.setPositionPercentage=function(a){d.setPosition(parseInt(a*(d.range[1]-d.range[0])+d.range[0]))};d.update=function(){h.text(d.position);q.css({width:(m.width()-15)*d.positionPercentage+15})};d.moveToNextFrame=function(){d.setPosition(d.position+1,!0)};d.moveToPreviousFrame=function(){d.setPosition(d.position-1,!0)};d.onFraming=function(){d.position>=d.range[1]?d.pause():
d.moveToNextFrame()};return d.endOfClass(arguments)};$ns("fo.view");$include("fo.res.SearchBoxView.css");
fo.view.SearchBoxView=function(){function a(){null!=h&&(clearTimeout(h),h=null);h=setTimeout(c,800)}function c(a){f.text!=g.val()&&(f.text=g.val(),f.trigger("changed"),null!=f.delegate&&isFunction(f.delegate.search)&&f.delegate.search(f.text,f))}function b(c){48<=c.keyCode&&90>=c.keyCode&&(g.val(""),g.focus(),$(document.body).off("keydown",b),a())}function e(b){a();27==b.keyCode&&(""!=g.val()?g.val(""):g.blur())}function k(a){$(document.body).on("keydown",b)}var f=$extend(mx.view.View);f.elementClass=
"SearchBoxView";f.frame={width:550};var d={};f.text="";f.delegate=null;var g=f.onchanged=null;d.init=f.init;f.init=function(a){d.init(a);f.$container.append("\x3cdiv id\x3d'head'/\x3e\x3cdiv id\x3d'body'/\x3e\x3cdiv id\x3d'tail'/\x3e\x3cinput/\x3e");g=f.$container.children("input");g.on("keydown",e);g.on("blur",k);$(document.body).on("keydown",b)};var h=null;return f.endOfClass(arguments)};$ns("fo.view");$include("fo.res.TaxonInfoView.css");
fo.view.TaxonInfoView=function(){var a=$extend(mx.view.View);a.elementClass="TaxonInfoView";var c={},b=a.taxon=null,e=null;c.init=a.init;a.init=function(k){c.init(k);b=$("\x3ch1 id\x3d'name'\x3eSchizolus dubiiformis\x3c/h1\x3e");a.$container.append(b);e=$("\x3cdiv id\x3d'detailList'/\x3e");e.append("\x3cdl\x3e\x3cdt\x3eRank:\x3c/dt\x3e \x3cdd id\x3d'rank'\x3e#1\x3c/dd\x3e\x3c/dl\x3e");e.append("\x3cdl\x3e\x3cdt\x3eClass:\x3c/dt\x3e \x3cdd id\x3d'cls'\x3eBivalvia\x3c/dd\x3e\x3c/dl\x3e");e.append("\x3cdl\x3e\x3cdt\x3eGenus:\x3c/dt\x3e \x3cdd id\x3d'genus'\x3ePalaeoneilo\x3c/dd\x3e\x3c/dl\x3e");
e.append("\x3cdl\x3e\x3cdt\x3eAuthor:\x3c/dt\x3e \x3cdd id\x3d'author'\x3eLi Xin\x3c/dd\x3e\x3c/dl\x3e");a.$container.append(e)};a.setTaxon=function(b){a.taxon=b;b={name:b.fullName,rank:"#"+(fo.taxons.indexOf(b)+1),cls:b.cls,genus:b.genus,author:b.author+"("+b.year+")"};for(var c in b){var d=b[c];a.$container.find("#"+c).text(d?d:"N/A")}};return a.endOfClass(arguments)};$ns("fo.view");$import("fo.view.View3D");$import("fo.ani.Animation");$include("fo.res.TaxonSeqView.css");$include("fo.res.TaxonSeqView3D.css");
fo.view.TaxonSeqView=function(){function a(a){a=fo.taxons[this.id];fo.app.popupScene("TaxonDetail",{taxon:a,title:a.fullName})}function c(a){if(a.shiftKey){a.preventDefault();var c=b.scale+a.originalEvent.wheelDelta/1E3;1<c?c=1:0.1>c&&(c=0.1);b.setScale(c)}else 0<a.originalEvent.wheelDeltaX&&0==b.$scene.get(0).scrollLeft&&a.preventDefault();a.stopPropagation()}var b=$extend(fo.view.View3D);b.elementClass="TaxonSeqView";b.renderingMode="css";var e={};b.mode="2D";b.scale=1;b.padding={top:75,left:25,
right:25};b.rootObject=null;b.$scene=null;b.$camera=null;b.styleSheet=null;e.init=b.init;b.init=function(a){e.init(a);b.startAnimation("Splash");for(a=a=0;a<document.styleSheets.length&&!document.styleSheets[a].href.contains("TaxonSeqView.css");a++);b.styleSheet=document.styleSheets[a]};e.initScene=b.initScene;b.initScene=function(){b.switchTo3D();"fast"==$speed&&setTimeout(function(){b.startAnimation("To2D")},50);e.initScene()};e.initCamera=b.initCamera;b.initCamera=function(){e.initCamera();b.camera.position.z=
0};b.initTaxons=function(){var a=d3.select(b.$container.get(0)).selectAll(".taxon").data(fo.taxons).enter().append("div").classed("taxon",!0).attr({id:function(a){return a.id}}).append("div").style({"background-color":function(){return"rgba(123, 29, 32, "+(0.4+0.5*Math.random())+")"}});a.append("span").attr("id","name").text(function(a){return a.name});a.append("span").attr("id","fullName").text(function(a){return a.fullName})};b.initObjects=function(){b.initTaxons();b.rootObject=new THREE.Object3D;
for(var a=new THREE.Vector3,c=b.$container.find(".taxon"),d=0;500>d;d++){var e=c.get(d),e=new THREE.CSS3DObject(e),h=Math.acos(-1+2*d/500),l=Math.sqrt(500*Math.PI)*h;e.position.x=1750*Math.cos(l)*Math.sin(h);e.position.y=1750*Math.sin(l)*Math.sin(h);e.position.z=1750*Math.cos(h);a.copy(e.position).multiplyScalar(2);e.lookAt(a);b.objects.add(e);b.rootObject.add(e)}b.scene.add(b.rootObject)};e.startAnimation=b.startAnimation;b.startAnimation=function(a,c){var d=null,d=fo.ani.Animation.createInstance(a,
{camera:b.camera,scene:b.scene,rootObject:b.rootObject,objects:b.objects,view:b});null!=d&&("fast"==$speed?d.duration*=0.05:"slow"==$speed&&(d.duration*=1.5),d.start());e.startAnimation();return d};b.switchTo3D=function(){b.mode="3D";b.$container.removeClass("two-d");b.$container.addClass("three-d")};b.switchTo2D=function(){b.stopAnimation();b.isRendering=!1;b.mode="2D";fo.app.searchBoxView.$container.delay(600).fadeIn("slow");b.$container.append("\x3cdiv id\x3d'topShadow' class\x3d'shadow'/\x3e\x3cdiv id\x3d'bottomShadow' class\x3d'shadow'/\x3e");
b.$container.find(".shadow").hide().fadeIn(5E3);b.$container.find(".camera").css({transform:"",webkitTransformStyle:"",webkitPerspective:""});b.$container.find(".scene").css({transform:"",webkitTransformStyle:"",webkitPerspective:""});b.$container.find(".taxon").css({transform:"",webkitTransformStyle:"",top:"",position:""});b.$container.find(".taxon div").css({height:"",border:"",borderRadius:""});b.$scene=b.$container.find(".scene");b.$scene.css({width:"",height:""});b.$camera=b.$container.find(".camera");
b.$camera.css({"-webkit-transform-origin-x":"","-webkit-transform-origin-y":"",width:"",height:""});b.$container.addClass("two-d");b.$container.removeClass("three-d");b.$camera.append(b.$container.children(".taxon"));b.$camera.append("\x3cdiv id\x3dplaceHolder/\x3e");TWEEN.removeAll();fo.app.searchBoxView.delegate=b;b.$scene.css("overflow","auto").on("mousewheel",c);b.$scene.on("click",".taxon",a)};b.search=function(a,c){b.setScale(1);var d=a.trim().toLowerCase();b.$scene.scrollTop(0);for(var e=0;e<
fo.taxons.length;e++){var h=fo.taxons[e],l=b.$container.find(".taxon#"+h.id);h.fullName.toLowerCase().startsWith(d)?l.show():l.hide()}};b.setScale=function(a){b.scale!=a&&(b.scale=a,a=parseInt(18*b.scale),b.styleSheet.rules[3].style.height=a+"px",b.styleSheet.rules[5].style.display=0.8<=b.scale?"":"none")};return b.endOfClass(arguments)};$ns("fo.view");
fo.view.View3D=function(){var a=$extend(mx.view.View);a.elementClass="View3D";var c={};a.isRendering=!0;a.isAnimating=!1;a.antialias=!1;a.scene=null;a.camera=null;a.renderer=null;a.renderingMode="webgl";a.rendererClass=THREE.WebGLRenderer;a.trackballControl=null;a.objects=[];a.onrendering=null;c.init=a.init;a.init=function(b){c.init(b);a.initScene();a.initCamera();a.initRenderer()};a.initScene=function(){a.scene=new THREE.Scene;a.initObjects()};a.initObjects=function(){};a.initRenderer=function(){a.rendererClass=
"css"==a.renderingMode?THREE.CSS3DRenderer:"canvas"==a.renderingMode?THREE.CanvasRenderer:THREE.WebGLRenderer;a.renderer=new a.rendererClass({antialias:a.antialias});a.renderer.setSize(a.frame.width,a.frame.height);a.$element.get(0).appendChild(a.renderer.domElement)};a.initCamera=function(){a.camera=new THREE.PerspectiveCamera(75,a.frame.width/a.frame.height,150,1E3)};a.initTrackballControl=function(){null==a.trackballControl&&(a.trackballControl=new THREE.TrackballControls(a.camera,a.renderer.domElement),
a.trackballControl.rotateSpeed=0.5,a.on("rendering",function(){a.trackballControl.update()}))};a.render=function(){a.isAnimating&&requestAnimationFrame(a.render);a.isRendering&&a.trigger("rendering");TWEEN.update();a.isRendering&&a.renderer.render(a.scene,a.camera)};a.startAnimation=function(){a.isAnimating=!0;a.render()};a.stopAnimation=function(){a.isAnimating=!1};return a.endOfClass(arguments)};